<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Webhook + Real URL Shortener + Self-Screenshot</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  body {
    font-family: system-ui, -apple-system, sans-serif;
    max-width: 720px;
    margin: 40px auto;
    padding: 20px;
    background: #0a0015;
    color: #e8d9ff;
  }
  h1 { color: #d1a3ff; text-align: center; margin-bottom: 0.4em; }
  .subtitle { text-align: center; color: #b39ddb; margin-bottom: 2em; font-size: 0.95em; }
  .card {
    background: #1c0038;
    padding: 28px;
    border-radius: 14px;
    margin: 28px 0;
    border: 1px solid #5e35b1;
    box-shadow: 0 4px 20px rgba(90, 40, 150, 0.25);
  }
  label { display: block; margin: 1.5em 0 0.6em; font-weight: 600; color: #d1c4e9; }
  input, button {
    width: 100%;
    padding: 14px 18px;
    margin: 8px 0;
    border-radius: 10px;
    border: 1px solid #7e57c2;
    font-size: 1.05rem;
  }
  input { background: #150026; color: white; }
  button {
    background: #7e57c2;
    color: white;
    border: none;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.22s;
  }
  button:hover { background: #9575cd; transform: translateY(-1px); }
  #status {
    margin-top: 1.8em;
    padding: 14px;
    border-radius: 10px;
    font-weight: 500;
    min-height: 1.4em;
  }
  .success { background: #1b5e20; color: #dcedc8; }
  .error   { background: #b71c1c; color: #ffcdd2; }
  #shortResult {
    margin-top: 1.2em;
    padding: 12px;
    background: #2a0052;
    border-radius: 10px;
    word-break: break-all;
  }
  #preview {
    max-width: 100%;
    margin-top: 1.8em;
    border: 3px solid #6a1b9a;
    border-radius: 10px;
    box-shadow: 0 6px 25px rgba(0,0,0,0.5);
    display: none;
  }
</style>
</head>
<body>

<h1>Discord Webhook + URL Shortener</h1>
<p class="subtitle">Real short links (shrtco.de) + screenshot of this page → sent to Discord<br>(No API keys needed!)</p>

<div class="card">
  <label for="webhook">1. Paste your Discord Webhook URL (saved only in your browser):</label>
  <input type="text" id="webhook" placeholder="https://discord.com/api/webhooks/...">
  <button onclick="saveWebhook()">Save Webhook & Unlock Tool</button>
</div>

<div class="card" id="mainSection" style="display:none;">
  <label for="longurl">2. Paste long URL to shorten:</label>
  <input type="text" id="longurl" placeholder="https://very.long.url.com/something/very/long/...">
  <button onclick="shortenAndSend()">Shorten URL + Send to Discord</button>

  <div id="status"></div>
  <div id="shortResult"></div>
  <img id="preview" alt="Screenshot preview of this tool page">
</div>

<script>
let WEBHOOK = localStorage.getItem("discordWebhook") || "";

const webhookInput = document.getElementById("webhook");
const mainSection  = document.getElementById("mainSection");
const statusDiv    = document.getElementById("status");
const resultDiv    = document.getElementById("shortResult");
const previewImg   = document.getElementById("preview");

if (WEBHOOK) {
  webhookInput.value = "•••••••• (saved in browser)";
  webhookInput.disabled = true;
  mainSection.style.display = "block";
}

function saveWebhook() {
  const val = webhookInput.value.trim();
  if (!val || !val.includes("discord.com/api/webhooks/")) {
    alert("Please enter a valid Discord webhook URL!");
    return;
  }
  localStorage.setItem("discordWebhook", val);
  WEBHOOK = val;
  webhookInput.value = "•••••••• (saved)";
  webhookInput.disabled = true;
  mainSection.style.display = "block";
  setStatus("Webhook saved! Ready to shorten URLs.", "success");
}

async function shortenAndSend() {
  const url = document.getElementById("longurl").value.trim();
  if (!url) return setStatus("Enter a valid URL first!", "error");
  if (!WEBHOOK) return setStatus("Webhook not saved yet!", "error");

  setStatus("Shortening URL + preparing screenshot... (5–12 seconds)", "success");

  try {
    // 1. Real URL shortening using free shrtco.de (no key, no registration)
    const shortRes = await fetch(`https://api.shrtco.de/v2/shorten?url=${encodeURIComponent(url)}`);
    const shortData = await shortRes.json();

    if (!shortData.ok) throw new Error(shortData.error || "Shortener failed");

    const shortLink = shortData.result.short_link; // or .full_short_link, .short_link2, etc.

    // 2. Screenshot of THIS page (only possible without backend)
    const canvas = await html2canvas(document.body, {
      scale: 1.3,
      useCORS: true,
      allowTaint: true,
      logging: false,
      windowWidth: document.documentElement.scrollWidth,
      windowHeight: Math.max(document.documentElement.scrollHeight, 1200)
    });

    previewImg.src = canvas.toDataURL("image/png");
    previewImg.style.display = "block";

    const blob = await new Promise(r => canvas.toBlob(r, "image/png"));
    const file = new File([blob], "preview.png", { type: "image/png" });

    // 3. Send to Discord
    const formData = new FormData();
    formData.append("file", file, "preview.png");

    const payload = {
      content: `**New shortened link!**\nOriginal: ${url}\nShort: **${shortLink}**\n\n(Screenshot = this tool page itself)`,
      embeds: [{
        title: "Short Link Created",
        description: shortLink,
        url: shortLink,
        color: 0x9c27b0,
        timestamp: new Date().toISOString()
      }]
    };

    formData.append("payload_json", JSON.stringify(payload));

    const webhookRes = await fetch(WEBHOOK, {
      method: "POST",
      body: formData
    });

    if (!webhookRes.ok) throw new Error(`Discord failed (${webhookRes.status})`);

    resultDiv.innerHTML = `Short link created: <strong><a href="${shortLink}" target="_blank" style="color:#d1a3ff;">${shortLink}</a></strong>`;
    setStatus("Success! Short link + screenshot sent to Discord.", "success");

  } catch (err) {
    console.error(err);
    setStatus("Error: " + (err.message || "Something went wrong..."), "error");
  }
}

function setStatus(text, type = "") {
  statusDiv.textContent = text;
  statusDiv.className = type;
}
</script>
</body>
</html>
